{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">Productos</h2>
        <a href="{{ url_for('productos.agregar_producto_view') }}" class="btn btn-success">
            <i class="bi bi-plus-lg"></i> Agregar Producto
        </a>
    </div>

    <!-- Filtros -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-funnel"></i> Filtros</h5>
        </div>
        <div class="card-body">
            <form method="GET" class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label for="categoria" class="form-label">Categoría</label>
                    <select id="categoria" name="categoria" class="form-select">
                        <option value="">Todas las categorías</option>
                        {% for cat in categorias %}
                        <option value="{{ cat }}" {% if categoria_filtro == cat %}selected{% endif %}>{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="codigo" class="form-label">Código de barras</label>
                    <input type="text" id="codigo" name="codigo" class="form-control" placeholder="Ej. 1234..." value="{{ codigo_filtro }}">
                </div>
                <div class="col-md-4">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search"></i> Aplicar
                    </button>
                    <a href="{{ url_for('productos.productos_list') }}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-counterclockwise"></i> Limpiar
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Tabla de productos -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-list-check"></i> Listado de Productos ({{ productos|length }})</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Precio</th>
                        <th>Stock</th>
                        <th>Categoría</th>
                        <th>Código</th>
                        <th style="width: 120px; text-align: center;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for producto in productos %}
                    <tr>
                        <td><small class="text-secondary">#{{ producto['id'] }}</small></td>
                        <td><strong>{{ producto['nombre'] }}</strong></td>
                        <td><strong class="text-info">₲{{ '{:,.0f}'.format(producto['precio']) }}</strong></td>
                        <td>
                            {% if producto['stock'] > 10 %}
                                <span class="badge bg-success">{{ producto['stock'] }}</span>
                            {% elif producto['stock'] > 0 %}
                                <span class="badge bg-warning">{{ producto['stock'] }}</span>
                            {% else %}
                                <span class="badge bg-danger">Agotado</span>
                            {% endif %}
                        </td>
                        <td><small>{{ producto['categoria'] }}</small></td>
                        <td><code class="text-secondary">{{ producto['codigo_barras'] }}</code></td>
                        <td style="text-align: center;">
                            <a href="{{ url_for('productos.editar_producto_view', id=producto['id']) }}" class="btn btn-sm btn-primary">
                                <i class="bi bi-pencil"></i>
                            </a>
                            <a href="{{ url_for('productos.eliminar_producto', id=producto['id']) }}" class="btn btn-sm btn-danger" onclick="return confirm('¿Estás seguro?')">
                                <i class="bi bi-trash"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Precio</th>
                <th>Stock</th>
                <th>Categoría</th>
                <th>Código de barras</th>
            </tr>
        </thead>
        <tbody>
            {% for producto in productos %}
            <tr>
                <td>{{ producto['id'] }}</td>
                <td>{{ producto['nombre'] }}</td>
                <td>₲{{ '{:,.0f}'.format(producto['precio']) }}</td>
                <td>{{ producto['stock'] }}</td>
                <td>{{ producto['categoria'] }}</td>
                <td>{{ producto['codigo_barras'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
